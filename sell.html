<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Upload Product - Customs Market</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 text-gray-900">

  <header class="bg-black text-white p-4 flex justify-between items-center">
    <h1 class="text-xl font-bold">Upload Product</h1>
    <div id="userInfo" class="text-sm hidden">
      Logged in as: <span id="userName"></span>
      <button id="logoutBtn" class="ml-2 underline text-red-400">Logout</button>
    </div>
    <button id="loginBtn" class="bg-white text-black px-4 py-1 rounded hidden">Sign in with Google</button>
  </header>

  <main class="p-6 max-w-xl mx-auto">
    <form id="uploadForm" class="space-y-4 hidden">
      <input id="name" class="w-full p-2 border rounded" placeholder="Product Name" required />
      <input id="price" class="w-full p-2 border rounded" placeholder="Price (e.g. $5)" required />
      <input id="seller" class="w-full p-2 border rounded" placeholder="Your Name / Brand" required />
      <input id="contact" class="w-full p-2 border rounded" placeholder="Contact (Email or Discord)" required />
      <input id="image" class="w-full p-2 border rounded" placeholder="Image URL" required />
      <button type="submit" class="bg-black text-white px-4 py-2 rounded w-full">Upload Product</button>
    </form>

    <p id="notSignedIn" class="text-center text-gray-500 mt-6">üîê Please sign in to upload products.</p>
  </main>

  <footer class="text-center py-6 text-sm text-gray-500">
    &copy; 2025 Customs Market
  </footer>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";
    import {
      getAuth,
      GoogleAuthProvider,
      signInWithPopup,
      onAuthStateChanged,
      signOut
    } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyA7IGIzhaH7F2-P-gZ3A7ARUfMFE7s4iBM",
      authDomain: "customs-market.firebaseapp.com",
      projectId: "customs-market",
      storageBucket: "customs-market.appspot.com",
      messagingSenderId: "242049210602",
      appId: "1:242049210602:web:9e87db4ca3ecdb942ddf93"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);
    const provider = new GoogleAuthProvider();

    const loginBtn = document.getElementById("loginBtn");
    const logoutBtn = document.getElementById("logoutBtn");
    const userInfo = document.getElementById("userInfo");
    const userName = document.getElementById("userName");
    const uploadForm = document.getElementById("uploadForm");
    const notSignedIn = document.getElementById("notSignedIn");

    loginBtn.addEventListener("click", () => {
      signInWithPopup(auth, provider)
        .then(result => {
          console.log("Logged in as", result.user.displayName);
        })
        .catch(err => {
          alert("Login error: " + err.message);
        });
    });

    logoutBtn.addEventListener("click", () => {
      signOut(auth).then(() => location.reload());
    });

    onAuthStateChanged(auth, user => {
      if (user) {
        userInfo.classList.remove("hidden");
        logoutBtn.classList.remove("hidden");
        userName.textContent = user.displayName;
        uploadForm.classList.remove("hidden");
        notSignedIn.classList.add("hidden");
        loginBtn.classList.add("hidden");
      } else {
        loginBtn.classList.remove("hidden");
      }
    });

    uploadForm.addEventListener("submit", async (e) => {
      e.preventDefault();

      const name = document.getElementById("name").value.trim();
      const price = document.getElementById("price").value.trim();
      const seller = document.getElementById("seller").value.trim();
      const contact = document.getElementById("contact").value.trim();
      const image = document.getElementById("image").value.trim();

      if (!name || !price || !seller || !contact || !image) {
        alert("Please fill out all fields.");
        return;
      }

      try {
        await addDoc(collection(db, "products"), {
          name,
          price,
          seller,
          contact,
          image
        });
        alert("‚úÖ Product uploaded!");
        uploadForm.reset();
      } catch (err) {
        console.error("Upload error:", err);
        alert("‚ùå Upload failed. Check console.");
      }
    });
  </script>
</body>
</html>


