<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Sell Product</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">

  <header class="bg-black text-white p-4 flex justify-between">
    <h1 class="text-xl font-bold">Sell a Product</h1>
    <div id="authArea" class="flex items-center gap-4">
      <button id="loginBtn" class="bg-white text-black px-4 py-1 rounded hidden">Sign in with Google</button>
      <div id="userInfo" class="hidden text-sm">
        Logged in as: <span id="userName"></span>
        <button id="logoutBtn" class="ml-2 underline text-red-400">Logout</button>
      </div>
    </div>
  </header>

  <main class="p-6 max-w-xl mx-auto">
    <form id="uploadForm" class="space-y-4 hidden">
      <input id="name" placeholder="Product Name" class="w-full p-2 border rounded" />
      <input id="price" placeholder="Price (e.g. $10)" class="w-full p-2 border rounded" />
      <input id="seller" placeholder="Your Name or Brand" class="w-full p-2 border rounded" />
      <input id="contact" placeholder="Contact (Email or Discord)" class="w-full p-2 border rounded" />
      <input id="image" placeholder="Image URL" class="w-full p-2 border rounded" />
      <button type="submit" class="bg-black text-white px-4 py-2 w-full rounded">Upload</button>
    </form>

    <p id="notSignedIn" class="text-center text-gray-500 mt-4">üîê Sign in to upload products.</p>
  </main>

  <script type="module">
    // 1. Firebase imports
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";
    import {
      getAuth,
      signInWithPopup,
      GoogleAuthProvider,
      onAuthStateChanged,
      signOut
    } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

    // 2. Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyA7IGIzhaH7F2-P-gZ3A7ARUfMFE7s4iBM",
      authDomain: "customs-market.firebaseapp.com",
      projectId: "customs-market",
      storageBucket: "customs-market.appspot.com",
      messagingSenderId: "242049210602",
      appId: "1:242049210602:web:9e87db4ca3ecdb942ddf93"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);
    const provider = new GoogleAuthProvider();

    // 3. DOM elements
    const loginBtn = document.getElementById("loginBtn");
    const logoutBtn = document.getElementById("logoutBtn");
    const userInfo = document.getElementById("userInfo");
    const userName = document.getElementById("userName");
    const uploadForm = document.getElementById("uploadForm");
    const notSignedIn = document.getElementById("notSignedIn");

    // 4. Auth state detection
    onAuthStateChanged(auth, (user) => {
      if (user) {
        console.log("‚úÖ Logged in as", user.email);
        loginBtn.classList.add("hidden");
        userInfo.classList.remove("hidden");
        userName.textContent = user.displayName;
        uploadForm.classList.remove("hidden");
        notSignedIn.classList.add("hidden");
      } else {
        console.log("üîê Not signed in");
        loginBtn.classList.remove("hidden");
        userInfo.classList.add("hidden");
        uploadForm.classList.add("hidden");
        notSignedIn.classList.remove("hidden");
      }
    });

    // 5. Sign in & out
    loginBtn.onclick = () => signInWithPopup(auth, provider).catch((err) => {
      console.error("Login error:", err.message);
      alert("Login failed: " + err.message);
    });

    logoutBtn.onclick = () => signOut(auth).then(() => location.reload());

    // 6. Upload form
    uploadForm.onsubmit = async (e) => {
      e.preventDefault();

      const name = document.getElementById("name").value.trim();
      const price = document.getElementById("price").value.trim();
      const seller = document.getElementById("seller").value.trim();
      const contact = document.getElementById("contact").value.trim();
      const image = document.getElementById("image").value.trim();

      if (!name || !price || !seller || !contact || !image) {
        alert("‚ùó Fill all fields!");
        return;
      }

      try {
        await addDoc(collection(db, "products"), { name, price, seller, contact, image });
        alert("‚úÖ Product uploaded!");
        uploadForm.reset();
      } catch (err) {
        console.error("Upload error:", err.message);
        alert("‚ùå Failed to upload");
      }
    };
  </script>
</body>
</html>

