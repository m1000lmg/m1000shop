<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Upload Product</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 text-gray-900">

  <header class="bg-black text-white p-4 flex justify-between items-center">
    <h1 class="text-xl font-bold">Upload Product</h1>
    <div class="flex gap-4 items-center">
      <div id="userInfo" class="hidden text-sm">
        Logged in as: <span id="userName" class="font-semibold"></span>
        <button id="logoutBtn" class="ml-2 text-red-400 underline">Logout</button>
      </div>
      <button id="loginBtn" class="bg-white text-black px-4 py-1 rounded">Sign in with Google</button>
    </div>
  </header>

  <main class="p-6 max-w-xl mx-auto">
    <form id="uploadForm" class="space-y-4 hidden">
      <input id="name" class="w-full p-2 border rounded" placeholder="Product Name" required />
      <input id="price" class="w-full p-2 border rounded" placeholder="Price (e.g. $5)" required />
      <input id="seller" class="w-full p-2 border rounded" placeholder="Your Name" required />
      <input id="contact" class="w-full p-2 border rounded" placeholder="Email or Discord" required />
      <input id="image" class="w-full p-2 border rounded" placeholder="Image URL" required />
      <button type="submit" class="bg-black text-white px-4 py-2 rounded w-full">Upload Product</button>
    </form>

    <p id="notSignedIn" class="text-center text-gray-500 mt-6">üîê Please sign in to upload products.</p>
  </main>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";
    import {
      getAuth,
      GoogleAuthProvider,
      signInWithPopup,
      onAuthStateChanged,
      signOut
    } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyA7IGIzhaH7F2-P-gZ3A7ARUfMFE7s4iBM",
      authDomain: "customs-market.firebaseapp.com",
      projectId: "customs-market",
      storageBucket: "customs-market.appspot.com",
      messagingSenderId: "242049210602",
      appId: "1:242049210602:web:9e87db4ca3ecdb942ddf93"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);
    const provider = new GoogleAuthProvider();

    const loginBtn = document.getElementById("loginBtn");
    const logoutBtn = document.getElementById("logoutBtn");
    const userInfo = document.getElementById("userInfo");
    const userName = document.getElementById("userName");
    const uploadForm = document.getElementById("uploadForm");
    const notSignedIn = document.getElementById("notSignedIn");

    loginBtn.onclick = async () => {
      try {
        await signInWithPopup(auth, provider);
      } catch (err) {
        alert("‚ùå Login failed: " + err.message);
        console.error(err);
      }
    };

    logoutBtn.onclick = () => signOut(auth).then(() => location.reload());

    onAuthStateChanged(auth, (user) => {
      if (user) {
        userInfo.classList.remove("hidden");
        logoutBtn.classList.remove("hidden");
        loginBtn.classList.add("hidden");
        userName.textContent = user.displayName;
        uploadForm.classList.remove("hidden");
        notSignedIn.classList.add("hidden");
        console.log("‚úÖ Logged in as", user.uid);
      } else {
        loginBtn.classList.remove("hidden");
        logoutBtn.classList.add("hidden");
        userInfo.classList.add("hidden");
        uploadForm.classList.add("hidden");
        notSignedIn.classList.remove("hidden");
        console.log("üü° Not signed in");
      }
    });

    uploadForm.onsubmit = async (e) => {
      e.preventDefault();

      const name = nameInput.value.trim();
      const price = priceInput.value.trim();
      const seller = sellerInput.value.trim();
      const contact = contactInput.value.trim();
      const image = imageInput.value.trim();

      if (!name || !price || !seller || !contact || !image) {
        alert("Fill all fields.");
        return;
      }

      try {
        await addDoc(collection(db, "products"), {
          name, price, seller, contact, image
        });
        alert("‚úÖ Uploaded!");
        uploadForm.reset();
      } catch (err) {
        console.error("Upload failed", err);
        alert("‚ùå Upload failed");
      }
    };

    const nameInput = document.getElementById("name");
    const priceInput = document.getElementById("price");
    const sellerInput = document.getElementById("seller");
    const contactInput = document.getElementById("contact");
    const imageInput = document.getElementById("image");
  </script>
</body>
</html>
