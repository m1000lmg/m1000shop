<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Sell a Product - Customs Market</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-white text-gray-800">

  <!-- Header -->
  <header class="bg-black text-white p-4 flex justify-between items-center">
    <h1 class="text-xl font-bold">Customs Market</h1>
    <nav class="space-x-4">
      <a href="index.html" class="hover:underline font-bold">Home</a>
      <a href="market.html" class="hover:underline">Market</a>
      <a href="sell.html" class="hover:underline">Sell</a>
    </nav>
  </header>

  <!-- Upload Form -->
  <main class="max-w-2xl mx-auto p-6">
    <h2 class="text-2xl font-bold mb-6">Upload Your Product</h2>
    <form id="uploadForm" class="space-y-4">

      <input type="text" name="name" placeholder="Product Name" required class="w-full border p-2 rounded" />
      <input type="text" name="price" placeholder="Price (e.g., $10)" required class="w-full border p-2 rounded" />
      <input type="text" name="seller" placeholder="Your Name or Alias" required class="w-full border p-2 rounded" />
      <input type="email" name="email" placeholder="Your Email" required class="w-full border p-2 rounded" />
      <input type="text" name="discord" placeholder="Your Discord (e.g. user#1234)" required class="w-full border p-2 rounded" />
      <textarea name="description" placeholder="Describe your product..." required class="w-full border p-2 rounded h-28"></textarea>
      <input type="file" name="image" id="image" accept="image/*" required class="w-full" />

      <button type="submit" class="bg-black text-white px-6 py-3 rounded hover:bg-gray-800 transition">
        Upload Product
      </button>
    </form>
  </main>

  <!-- Footer -->
  <footer class="text-center py-6 text-sm text-gray-500">
    &copy; 2025 Customs Market. All rights reserved.
  </footer>

  <!-- Firebase Upload Script -->
  <script type="module">
    // Firebase SDKs
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";
    import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-storage.js";

    // Your Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyA7IGIzhaH7F2-P-gZ3A7ARUfMFE7s4iBM",
      authDomain: "customs-market.firebaseapp.com",
      projectId: "customs-market",
      storageBucket: "customs-market.appspot.com", // FIXED spelling!
      messagingSenderId: "242049210602",
      appId: "1:242049210602:web:9e87db4ca3ecdb942ddf93",
      measurementId: "G-LSDKL5TE3D"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const storage = getStorage(app);

    // Handle form submit
    const form = document.getElementById("uploadForm");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      const name = form.name.value;
      const price = form.price.value;
      const seller = form.seller.value;
      const email = form.email.value;
      const discord = form.discord.value;
      const description = form.description.value;
      const imageFile = form.image.files[0];

      try {
        // Upload image to Firebase Storage
        const imgRef = ref(storage, "product-images/" + Date.now() + "-" + imageFile.name);
        await uploadBytes(imgRef, imageFile);
        const imageURL = await getDownloadURL(imgRef);

        // Save product data to Firestore
        await addDoc(collection(db, "products"), {
          name,
          price,
          seller,
          description,
          image: imageURL,
          contact: {
            email,
            discord
          }
        });

        alert("✅ Product uploaded successfully!");
        window.location.href = "market.html";

      } catch (err) {
        console.error("Upload failed", err);
        alert("❌ Failed to upload product: " + err.message);
      }
    });
  </script>

</body>
</html>

